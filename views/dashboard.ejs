<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>MerryWeather-Time - Dashboard</title>
  <link rel="stylesheet" href="/css/style.css">
  <script defer src="/js/app.js"></script>
</head>
<body style="background-image: url('<%= bgUrl %>');">
  <div class="overlay"></div>

  <aside class="sidebar">
    <div class="brand">
      <img src="<%= logoUrl %>" class="logo-sm" alt="logo">
      <h3>MerryWeather-Time</h3>
    </div>
    <nav>
      <a href="/dashboard" class="active">Ch·∫•m c√¥ng</a>
      <a href="#history" onclick="showTab('history')">L·ªãch s·ª≠</a>
      <a href="#staff" onclick="showTab('staff')">Danh s√°ch nh√¢n vi√™n</a>
      <a href="#rules" onclick="showTab('rules')">Lu·∫≠t l·ªá</a>
      <a href="#admin" onclick="showTab('admin')">Qu·∫£n tr·ªã</a>
      <a href="/logout">ƒêƒÉng xu·∫•t</a>
    </nav>
    <footer class="sidebar-footer">
      <img src="/assets/mw-small.png" alt="mw" style="width:40px;">
      <div>¬© MerryWeather</div>
    </footer>
  </aside>

  <main class="main">
    <header class="topbar">
      <div class="notice-bar">
        <% if(notices && notices.length) { %>
          <marquee behavior="scroll" direction="left"><%= notices[0].text %></marquee>
        <% } else { %>
          <span>Ch∆∞a c√≥ th√¥ng b√°o</span>
        <% } %>
      </div>
      <div class="user">Xin ch√†o, <strong><%= user.name %></strong></div>
    </header>

    <section class="content" id="tab-chamcong">
      <h2>Ch·∫•m c√¥ng</h2>
      <div class="card center">
        <form method="post" action="/onduty" style="display:inline-block;margin-right:12px;">
          <button class="btn-large btn-green" id="btn-onduty">üö® OnDuty</button>
        </form>
        <form method="post" action="/offduty" style="display:inline-block;">
          <button class="btn-large btn-red" id="btn-offduty">‚úÖ OffDuty</button>
        </form>
      </div>
    </section>

    <section class="content hide" id="history">
      <h2>L·ªãch s·ª≠ ch·∫•m c√¥ng</h2>
      <table class="table">
        <thead><tr><th>Email</th><th>Tr·∫°ng th√°i</th><th>Th·ªùi gian</th></tr></thead>
        <tbody>
          <% shifts.forEach(s => { %>
            <tr><td><%= s.email %></td><td><%= s.type %></td><td><%= s.time %></td></tr>
          <% }) %>
        </tbody>
      </table>
    </section>

    <section class="content hide" id="staff">
      <h2>Danh s√°ch nh√¢n vi√™n</h2>
      <table class="table">
        <thead><tr><th>T√™n</th><th>Email</th><th>Vai tr√≤</th></tr></thead>
        <tbody>
          <% users.forEach(u => { %>
            <tr><td><%= u.name %></td><td><%= u.email %></td><td><%= u.role %></td></tr>
          <% }) %>
        </tbody>
      </table>
    </section>

    <section class="content hide" id="rules">
      <h2>Lu·∫≠t l·ªá / N·ªôi quy</h2>
      <% rules.forEach(r=>{ %>
        <div class="rule">
          <h4><%= r.title %></h4>
          <p><%= r.content %></p>
        </div>
      <% }) %>

      <% if(user.role === "admin") { %>
      <form method="post" action="/admin/add-rule" class="card">
        <h4>Th√™m Lu·∫≠t l·ªá</h4>
        <input name="title" placeholder="Ti√™u ƒë·ªÅ" required>
        <textarea name="content" placeholder="N·ªôi dung" required></textarea>
        <button class="btn-red">L∆∞u lu·∫≠t l·ªá</button>
      </form>
      <% } %>
    </section>

    <section class="content hide" id="admin">
      <h2>Qu·∫£n tr·ªã</h2>
      <% if(user.role === "admin") { %>
      <div class="card">
        <h4>T·∫°o nh√¢n vi√™n</h4>
        <form method="post" action="/admin/add-user">
          <input name="name" placeholder="T√™n" required>
          <input name="email" placeholder="Email" required>
          <input name="password" placeholder="M·∫≠t kh·∫©u" required>
          <select name="role"><option value="guard">guard</option><option value="admin">admin</option></select>
          <button class="btn-red">T·∫°o</button>
        </form>
      </div>

      <div class="card">
        <h4>G·ª≠i th√¥ng b√°o nhanh</h4>
        <form method="post" action="/admin/add-notice">
          <input name="text" placeholder="N·ªôi dung th√¥ng b√°o" required>
          <button class="btn-green">G·ª≠i</button>
        </form>
      </div>
      <% } else { %>
        <div class="card">B·∫°n kh√¥ng c√≥ quy·ªÅn admin.</div>
      <% } %>
    </section>

  </main>

  <audio id="sfx-on" src="/assets/on.mp3" preload="auto"></audio>
  <audio id="sfx-off" src="/assets/off.mp3" preload="auto"></audio>
</body>
</html>
